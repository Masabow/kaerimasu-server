<!DOCTYPE html>
<html>
<head>
<title><%= title %></title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
<link rel='stylesheet' href='/stylesheets/style.css' />
</head>
<body>
	<h1><%= title %></h1>
	<p>Welcome to <%= title %></p>
	<div class="container-fluid">
		<div id="map"></div>
	</div>
	a
</body>
<script
  src="https://code.jquery.com/jquery-3.3.1.js"
  integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
  crossorigin="anonymous"></script>
<script>

       function initMap() {
    var directionsService = new google.maps.DirectionsService;
    var directionsDisplay = new google.maps.DirectionsRenderer;
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -34.397, lng: 150.644},
          zoom: 20
        });
        directionsDisplay.setMap(map);
        var infoWindow = new google.maps.InfoWindow({map: map});

        // Try HTML5 geolocation.
        if (navigator.geolocation) { 
                  navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            infoWindow.setPosition(pos);
            infoWindow.setContent('現在位置');
            
            map.setCenter(pos);
            
            directionsService.route({
                origin: pos,
                destination: '大阪狭山市駅',
                travelMode: 'DRIVING'
              }, function(response, status) {
                if (status === 'OK') {
                	var data = {
                		'start_address':response.routes[0].legs[0].start_address,
                		'duration':response.routes[0].legs[0].duration,
                		'distance':response.routes[0].legs[0].distance
                	}
                	console.log(response);
                    $.ajax({
                  	  type: 'POST',
                  	  url: '/',
                  	  data: data,
                  	  success: function(){},
                  	  dataType: 'json'
                  	});
                	
                  directionsDisplay.setDirections(response);
                } else {
                  window.alert('Directions request failed due to ' + status);
                }
              });            
            
            
            console.log(pos);
        }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        }}
        </script>
        
	<script async defer
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3MtiW-6YpEnqzelmBq9W4g2CtEtA28oc&callback=initMap">
    </script>
</html>